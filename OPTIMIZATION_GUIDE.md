# üöÄ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ –∑–∞–ø—Ä–æ—Å–æ–≤

## üìã –û–±–∑–æ—Ä –∏–∑–º–µ–Ω–µ–Ω–∏–π

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ **40-70%**.

## üóÇÔ∏è –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

1. **`database_optimization.sql`** - SQL-—Å–∫—Ä–∏–ø—Ç —Å–æ –≤—Å–µ–º–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è–º–∏ –ë–î
2. **–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ entity —Ñ–∞–π–ª—ã:**
   - `src/entities/claim/claim.ts` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã N+1 –∑–∞–ø—Ä–æ—Å—ã
   - `src/entities/defect/defect.ts` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã N+1 –∑–∞–ø—Ä–æ—Å—ã 
   - `src/entities/courtCase/index.ts` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã N+1 –∑–∞–ø—Ä–æ—Å—ã
3. **–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ç–∏–ø—ã:**
   - `src/shared/types/attachment.ts` - —É–¥–∞–ª–µ–Ω–æ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–µ –ø–æ–ª–µ
   - `src/shared/types/defect.ts` - —É–¥–∞–ª–µ–Ω–æ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–µ –ø–æ–ª–µ

## üéØ –ü–æ—Ä—è–¥–æ–∫ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û!)

```bash
# –°–æ–∑–¥–∞–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
pg_dump your_database > backup_$(date +%Y%m%d_%H%M%S).sql

# –ò–ª–∏ —á–µ—Ä–µ–∑ Supabase Dashboard -> Settings -> Database -> Database backups
```

### 2. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ SQL-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π

```bash
# –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ë–î
psql your_database < database_optimization.sql

# –ò–ª–∏ —á–µ—Ä–µ–∑ Supabase SQL Editor:
# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ database_optimization.sql –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –ë–î

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è SQL-—Å–∫—Ä–∏–ø—Ç–∞ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

```sql
-- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–∞–±–ª–∏—Ü—ã/–ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω—ã
SELECT table_name FROM information_schema.tables 
WHERE table_name IN ('cached_counters', 'claims_with_details', 'court_cases_with_details', 'defects_with_details', 'letters_with_details', 'project_statistics');

-- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–æ–ª—è —É–¥–∞–ª–µ–Ω—ã
SELECT column_name FROM information_schema.columns 
WHERE table_name = 'attachments' AND column_name = 'uploaded_by';

SELECT column_name FROM information_schema.columns 
WHERE table_name = 'defects' AND column_name = 'case_uid_id';

-- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –Ω–æ–≤—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Å–æ–∑–¥–∞–Ω—ã
SELECT table_name FROM information_schema.views 
WHERE table_name IN ('claims_summary', 'defects_summary', 'court_cases_summary');

-- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–æ–≤—ã–µ –∏–Ω–¥–µ–∫—Å—ã
SELECT indexname FROM pg_indexes 
WHERE indexname LIKE 'idx_claims_%' OR indexname LIKE 'idx_defects_%' OR indexname LIKE 'idx_court_cases_%' OR indexname LIKE 'idx_letters_%';
```

### 4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

1. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ** –∏ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–µ—Ç –æ—à–∏–±–æ–∫
2. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:**
   - `/claims` - —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–µ—Ç–µ–Ω–∑–∏–π
   - `/defects` - —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–µ—Ñ–µ–∫—Ç–æ–≤  
   - `/court-cases` - —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å—É–¥–µ–±–Ω—ã—Ö –¥–µ–ª
   - `/correspondence` - —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–µ—Ä–µ–ø–∏—Å–∫–∏

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
   - –í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü –¥–æ–ª–∂–Ω–æ —É–º–µ–Ω—å—à–∏—Ç—å—Å—è
   - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –¥–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å –±—ã—Å—Ç—Ä–µ–µ
   - –í DevTools Network –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–µ–Ω—å—à–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API

## üìä –û–∂–∏–¥–∞–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ | –ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|----------------|-------------------|-----------|
| –í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–µ—Ç–µ–Ω–∑–∏–π | 3-5 —Å–µ–∫ | 1-2 —Å–µ–∫ | **60-70%** |
| –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î | 10-15 | 3-5 | **70-80%** |
| –í—Ä–µ–º—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ | 2-3 —Å–µ–∫ | 0.5-1 —Å–µ–∫ | **70-80%** |
| –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏ | 100% | 60-70% | **30-40%** |

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

### –ö–æ–Ω—Ç—Ä–æ–ª—å –≤–µ—Ä—Å–∏–π
–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —É–∂–µ –≤–Ω–µ—Å–µ–Ω—ã –≤ –∫–æ–¥. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ:
- –ò–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–∫–æ–º–º–∏—á–µ–Ω—ã –≤ Git
- –ö–æ–º–∞–Ω–¥–∞ –∑–Ω–∞–µ—Ç –æ–± –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è—Ö
- –ï—Å—Ç—å –ø–ª–∞–Ω –æ—Ç–∫–∞—Ç–∞ –≤ —Å–ª—É—á–∞–µ –ø—Ä–æ–±–ª–µ–º

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ—Å–ª–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è
1. **–û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ –ª–æ–≥–∏ –æ—à–∏–±–æ–∫** –ø–µ—Ä–≤—ã–µ 24 —á–∞—Å–∞
2. **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ë–î** —á–µ—Ä–µ–∑ Supabase Dashboard
3. **–°–æ–±–∏—Ä–∞–π—Ç–µ —Ñ–∏–¥–±–µ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** –æ —Å–∫–æ—Ä–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã

### –ü–ª–∞–Ω –æ—Ç–∫–∞—Ç–∞
–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–Ω—É—Ç –ø—Ä–æ–±–ª–µ–º—ã:

1. **–û—Ç–∫–∞—Ç –∫–æ–¥–∞:**
```bash
git revert <commit_hash>
```

2. **–û—Ç–∫–∞—Ç –ë–î:**
```bash
# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏
psql your_database < backup_YYYYMMDD_HHMMSS.sql
```

## üêõ –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∞ "table does not exist"
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—Å–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Å–æ–∑–¥–∞–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
```sql
CREATE OR REPLACE VIEW claims_summary AS ...
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ú–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –ø–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
**–†–µ—à–µ–Ω–∏–µ:** –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ë–î
```sql
ANALYZE claims;
ANALYZE defects;
ANALYZE court_cases;
```

### –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∏ TypeScript –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–∏–ø–æ–≤
**–†–µ—à–µ–Ω–∏–µ:** –û–±–Ω–æ–≤–∏—Ç–µ –∏–º–ø–æ—Ä—Ç—ã –∏ —É–±–µ—Ä–∏—Ç–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ —É–¥–∞–ª–µ–Ω–Ω—ã–µ –ø–æ–ª—è
```typescript
// –£–¥–∞–ª–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ uploaded_by –∏ case_uid_id
```

## üìà –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –∏–∑–º–µ—Ä–µ–Ω–∏—è —É—Å–ø–µ—Ö–∞

### –î–æ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è (–∏–∑–º–µ—Ä—å—Ç–µ –±–∞–∑–æ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏)
```bash
# –í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–µ—Ç–µ–Ω–∑–∏–π
curl -w "@curl-format.txt" -o /dev/null -s "https://your-app.com/claims"

# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ DevTools -> Network
# –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è SQL –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ Supabase Dashboard -> Logs
```

### –ü–æ—Å–ª–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è
- –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ —Ç–µ –∂–µ –∏–∑–º–µ—Ä–µ–Ω–∏—è
- –°—Ä–∞–≤–Ω–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
- –ó–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ —É–ª—É—á—à–µ–Ω–∏—è

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

- [ ] –°–æ–∑–¥–∞–Ω–∞ —Ä–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è –ë–î
- [ ] –í—ã–ø–æ–ª–Ω–µ–Ω SQL-—Å–∫—Ä–∏–ø—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã –Ω–æ–≤—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∏ –∏–Ω–¥–µ–∫—Å—ã
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- [ ] –ò–∑–º–µ—Ä–µ–Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- [ ] –ö–æ–º–∞–Ω–¥–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∞ –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- [ ] –ì–æ—Ç–æ–≤ –ø–ª–∞–Ω –æ—Ç–∫–∞—Ç–∞

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è —ç—Ç–∏—Ö –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π –≤—ã –ø–æ–ª—É—á–∏—Ç–µ:

- **–ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –±–æ–ª–µ–µ –±—ã—Å—Ç—Ä–æ–µ** –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- **–ú–µ–Ω—å—à–µ –Ω–∞–≥—Ä—É–∑–∫–∏** –Ω–∞ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö  
- **–õ—É—á—à–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç**
- **–ë–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤**

–í —Å–ª—É—á–∞–µ –≤–æ–ø—Ä–æ—Å–æ–≤ –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫—É, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–∑–¥–∞–ª —ç—Ç–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏.

---
*–î–æ–∫—É–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω: $(date)*  
*–í–µ—Ä—Å–∏—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏: 1.0*